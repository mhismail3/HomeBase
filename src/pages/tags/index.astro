---
import Base from '../../layouts/Base.astro';
import { getCollection } from 'astro:content';
const posts = await getCollection('posts', ({ data }) => !data.draft);
const tagMap = new Map<string, number>();
for (const p of posts) {
  for (const t of p.data.tags ?? []) tagMap.set(t, (tagMap.get(t) ?? 0) + 1);
}
const tags = Array.from(tagMap.entries()).sort((a, b) => a[0].localeCompare(b[0]));
const base: string = import.meta.env.BASE_URL || '/';
---
<Base title="Tags â€” Home Base">
  <h1>tags</h1>
  {tags.length === 0 ? (
    <p>No tags yet.</p>
  ) : (
    <ul class="post-list">
      {tags.map(([tag, count]) => (
        <li>
          <a href={`${base}tags/${encodeURIComponent(tag)}/`}>{tag}</a> <small>({count})</small>
        </li>
      ))}
    </ul>
  )}
</Base>

